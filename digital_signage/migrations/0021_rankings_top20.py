# Generated by Django 4.2

from django.db import migrations


def update_rankings_to_top20(apps, schema_editor):
    """Update ranking screens to show top 20 instead of all locations."""
    ScreenDesign = apps.get_model('digital_signage', 'ScreenDesign')

    # Update Today Rankings
    try:
        screen = ScreenDesign.objects.get(slug='jumpca-today-rankings')
        screen.name = "Jump.ca - Today Top 20"
        screen.description = "Top 20 locations for Today - Devices and Profit"
        screen.html_code = """<div class="screen-container">
    <div class="screen-header">
        <h1 class="screen-title">Today - Top 20</h1>
    </div>

    <div class="single-column">
        <div class="leaderboard-panel">
            <h2 class="panel-title">Devices Ranking</h2>
            <div class="leaderboard-list">
                {{#each sales.today.top20_devices}}
                <div class="leaderboard-item rank-{{rank}}">
                    <div class="rank-badge">{{rank}}</div>
                    <span class="store-name">{{store_name}}</span>
                    <span class="store-value">{{value}}</span>
                </div>
                {{/each}}
            </div>
        </div>

        <div class="leaderboard-panel">
            <h2 class="panel-title">Profit Ranking</h2>
            <div class="leaderboard-list">
                {{#each sales.today.top20_profit}}
                <div class="leaderboard-item rank-{{rank}}">
                    <div class="rank-badge">{{rank}}</div>
                    <span class="store-name">{{store_name}}</span>
                    <span class="store-value">{{value}}</span>
                </div>
                {{/each}}
            </div>
        </div>
    </div>

    <div class="screen-footer">
        <span class="footer-text">Data refreshes every 5 minutes</span>
    </div>
</div>"""
        screen.save()
    except ScreenDesign.DoesNotExist:
        pass

    # Update WTD Rankings
    try:
        screen = ScreenDesign.objects.get(slug='jumpca-wtd-rankings')
        screen.name = "Jump.ca - Week to Date Top 20"
        screen.description = "Top 20 locations for Week to Date - Devices and Profit"
        screen.html_code = """<div class="screen-container">
    <div class="screen-header">
        <h1 class="screen-title">Week to Date - Top 20</h1>
    </div>

    <div class="single-column">
        <div class="leaderboard-panel">
            <h2 class="panel-title">Devices Ranking</h2>
            <div class="leaderboard-list">
                {{#each sales.wtd.top20_devices}}
                <div class="leaderboard-item rank-{{rank}}">
                    <div class="rank-badge">{{rank}}</div>
                    <span class="store-name">{{store_name}}</span>
                    <span class="store-value">{{value}}</span>
                </div>
                {{/each}}
            </div>
        </div>

        <div class="leaderboard-panel">
            <h2 class="panel-title">Profit Ranking</h2>
            <div class="leaderboard-list">
                {{#each sales.wtd.top20_profit}}
                <div class="leaderboard-item rank-{{rank}}">
                    <div class="rank-badge">{{rank}}</div>
                    <span class="store-name">{{store_name}}</span>
                    <span class="store-value">{{value}}</span>
                </div>
                {{/each}}
            </div>
        </div>
    </div>

    <div class="screen-footer">
        <span class="footer-text">Data refreshes every 5 minutes</span>
    </div>
</div>"""
        screen.save()
    except ScreenDesign.DoesNotExist:
        pass

    # Update MTD Rankings
    try:
        screen = ScreenDesign.objects.get(slug='jumpca-mtd-rankings')
        screen.name = "Jump.ca - Month to Date Top 20"
        screen.description = "Top 20 locations for Month to Date - Devices and Profit"
        screen.html_code = """<div class="screen-container">
    <div class="screen-header">
        <h1 class="screen-title">Month to Date - Top 20</h1>
    </div>

    <div class="single-column">
        <div class="leaderboard-panel">
            <h2 class="panel-title">Devices Ranking</h2>
            <div class="leaderboard-list">
                {{#each sales.mtd.top20_devices}}
                <div class="leaderboard-item rank-{{rank}}">
                    <div class="rank-badge">{{rank}}</div>
                    <span class="store-name">{{store_name}}</span>
                    <span class="store-value">{{value}}</span>
                </div>
                {{/each}}
            </div>
        </div>

        <div class="leaderboard-panel">
            <h2 class="panel-title">Profit Ranking</h2>
            <div class="leaderboard-list">
                {{#each sales.mtd.top20_profit}}
                <div class="leaderboard-item rank-{{rank}}">
                    <div class="rank-badge">{{rank}}</div>
                    <span class="store-name">{{store_name}}</span>
                    <span class="store-value">{{value}}</span>
                </div>
                {{/each}}
            </div>
        </div>
    </div>

    <div class="screen-footer">
        <span class="footer-text">Data refreshes every 5 minutes</span>
    </div>
</div>"""
        screen.save()
    except ScreenDesign.DoesNotExist:
        pass


def revert_rankings_to_all(apps, schema_editor):
    """Revert (no-op)."""
    pass


class Migration(migrations.Migration):

    dependencies = [
        ('digital_signage', '0020_dashboard_badge_style'),
    ]

    operations = [
        migrations.RunPython(update_rankings_to_top20, revert_rankings_to_all),
    ]
